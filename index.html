<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة التابعين العالمية | النظام المتكامل 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@200;300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* =========================================
           1. نظام الألوان والسمات (Deep Theme Engine)
           ========================================= */
        :root {
            --primary: #001a35;
            --primary-light: #002d5a;
            --accent: #c5a059;
            --accent-dark: #a88543;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-title: #001a35;
            --text-body: #475569;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --shadow-royal: 0 25px 50px -12px rgba(0, 0, 0, 0.08);
            --transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.dark-mode {
            --primary: #020617;
            --primary-light: #0f172a;
            --accent: #d4af37;
            --accent-dark: #b8860b;
            --bg-main: #020617;
            --bg-card: #0f172a;
            --text-title: #f1f5f9;
            --text-body: #94a3b8;
            --glass-bg: rgba(15, 23, 42, 0.8);
            --shadow-royal: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* =========================================
           2. التنسيقات العامة (Global Styles)
           ========================================= */
        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg-main); color: var(--text-body); transition: var(--transition); line-height: 1.8; overflow-x: hidden; }
        .quran-text { font-family: 'Amiri', serif; }
        
        /* تحسين الخانات */
        input, select, textarea { 
            background: var(--bg-card) !important; color: var(--text-title) !important; 
            border: 2px solid rgba(197, 160, 89, 0.2) !important; border-radius: 15px !important;
            padding: 15px 20px !important; font-weight: 700 !important; transition: var(--transition);
        }
        input:focus { border-color: var(--accent) !important; outline: none; box-shadow: 0 0 15px rgba(197, 160, 89, 0.2); }

        /* =========================================
           3. أنظمة التفاعل (Animation Classes)
           ========================================= */
        .page-node { display: none; opacity: 0; transform: translateY(50px); }
        .page-node.active { display: block; opacity: 1; transform: translateY(0); animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        .hover-lift { transition: var(--transition); }
        .hover-lift:hover { transform: translateY(-10px) scale(1.02); }

        /* =========================================
           4. خريطة الحفظ (Journey Map System)
           ========================================= */
        .journey-container { position: relative; padding: 60px 0; overflow-x: auto; white-space: nowrap; }
        .journey-line { position: absolute; top: 50%; left: 0; width: 100%; height: 6px; background: #cbd5e1; z-index: 1; transform: translateY(-50%); border-radius: 10px; }
        .journey-fill { position: absolute; top: 50%; right: 0; height: 6px; background: var(--accent); z-index: 2; transform: translateY(-50%); transition: width 1.5s ease-in-out; border-radius: 10px; }
        
        .milestone { 
            display: inline-block; width: 80px; height: 80px; background: var(--bg-card); 
            border: 5px solid #cbd5e1; border-radius: 50%; position: relative; z-index: 3;
            margin: 0 40px; text-align: center; line-height: 70px; font-weight: 900;
            transition: var(--transition); cursor: pointer;
        }
        .milestone.active { border-color: var(--accent); background: var(--primary); color: var(--accent); box-shadow: 0 0 30px var(--accent); }
        .milestone.completed { background: var(--accent); border-color: var(--accent); color: white; }
        .milestone-label { position: absolute; top: 90px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 800; color: var(--text-title); }

        /* =========================================
           5. نظام البطاقات الملكية (Royal Cards)
           ========================================= */
        .royal-card {
            background: var(--bg-card); border-radius: 40px; padding: 45px;
            box-shadow: var(--shadow-royal); border: 1px solid rgba(197, 160, 89, 0.1);
            position: relative; overflow: hidden;
        }
        .royal-card::before {
            content: ""; position: absolute; top: 0; right: 0; width: 10px; height: 100%;
            background: var(--accent);
        }

        /* =========================================
           6. المساعد الذكي الصوتي (AI Interface)
           ========================================= */
        .chat-container { height: 500px; overflow-y: auto; scroll-behavior: smooth; padding-right: 10px; }
        .chat-bubble { max-width: 80%; padding: 20px; border-radius: 25px; margin-bottom: 15px; font-weight: 600; font-size: 14px; position: relative; animation: pop 0.4s ease; }
        @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .bot-msg { background: var(--primary); color: white; border-bottom-right-radius: 5px; }
        .user-msg { background: var(--accent); color: var(--primary); border-bottom-left-radius: 5px; margin-right: auto; }

        .mic-active { animation: pulse-red 1.5s infinite; color: #ef4444 !important; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        /* =========================================
           7. حائط الداعمين (Wall of Honor)
           ========================================= */
        .marquee-wrapper { background: var(--primary); padding: 15px 0; border-top: 4px solid var(--accent); border-bottom: 4px solid var(--accent); overflow: hidden; }
        .marquee-content { display: flex; animation: scrollWall 30s linear infinite; }
        @keyframes scrollWall { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .donor-tag { padding: 0 50px; color: var(--accent); font-weight: 900; font-style: italic; display: flex; align-items: center; gap: 10px; white-space: nowrap; }

        /* =========================================
           8. الوضع الليلي (Toggle Switch)
           ========================================= */
        .theme-switch { width: 60px; height: 30px; background: #cbd5e1; border-radius: 20px; position: relative; cursor: pointer; transition: 0.3s; }
        .theme-switch::after { content: "\f185"; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; left: 5px; top: 50%; transform: translateY(-50%); width: 22px; height: 22px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #f59e0b; transition: 0.3s; }
        body.dark-mode .theme-switch { background: var(--accent); }
        body.dark-mode .theme-switch::after { content: "\f186"; left: 33px; color: var(--primary); }

        /* =========================================
           9. بطاقة التميز (Excellence Card Canvas)
           ========================================= */
        #card-capture-area {
            width: 800px; height: 500px; background: linear-gradient(135deg, #001a35, #003366);
            border: 20px solid #c5a059; padding: 60px; color: white; position: fixed;
            left: -9999px; top: -9999px; text-align: center;
        }
    </style>
</head>
<body>

    <div class="marquee-wrapper">
        <div class="marquee-content" id="wall-of-honor">
            </div>
    </div>

    <header class="sticky top-0 z-[1000] bg-white/90 dark:bg-black/90 backdrop-blur-md border-b border-accent/20 py-5 px-10">
        <div class="max-w-[1600px] mx-auto flex justify-between items-center">
            <div class="flex items-center gap-6 cursor-pointer group" onclick="nav('home')">
                <div class="w-16 h-16 bg-primary rounded-[20px] flex items-center justify-center text-accent text-3xl shadow-2xl transition-transform group-hover:rotate-12">
                    <i class="fas fa-quran"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-black text-primary dark:text-white tracking-tighter">مركز التابعين</h1>
                    <p class="text-[10px] font-black text-accent uppercase tracking-[0.4em]">بإشراف أ. إسماعيل نوفل</p>
                </div>
            </div>

            <nav class="hidden xl:flex items-center gap-12 font-black text-[12px] uppercase">
                <button onclick="nav('home')" class="hover:text-accent transition">الرئيسية</button>
                <button onclick="nav('rings')" class="hover:text-accent transition">دليل الحلقات</button>
                <button onclick="nav('ai')" class="hover:text-accent transition">المعلم الصوتي</button>
                <button onclick="nav('student')" class="text-blue-600 bg-blue-50 dark:bg-blue-900/20 px-6 py-2 rounded-full">بوابة الطالب</button>
                <div class="theme-switch" onclick="toggleTheme()"></div>
                <button onclick="nav('donate')" class="bg-accent text-primary px-8 py-4 rounded-2xl shadow-xl hover:scale-105 transition-all">مساهمة وقفية</button>
            </nav>

            <button class="xl:hidden text-2xl text-primary dark:text-white"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <div id="inspiration-popup" class="fixed bottom-10 left-10 z-[1100] max-w-sm bg-accent p-8 rounded-[35px] shadow-2xl hidden transition-all">
        <div class="flex justify-between items-center mb-4">
            <i class="fas fa-star text-primary"></i>
            <button onclick="closeInspiration()" class="text-[10px] font-black uppercase opacity-50">إغلاق</button>
        </div>
        <p id="inspiration-content" class="text-primary font-black text-sm italic leading-relaxed"></p>
        <p class="text-[9px] mt-4 font-bold opacity-60">توجيهات إيمانية - مركز التابعين</p>
    </div>

    <main id="homePage" class="page-node active max-w-[1600px] mx-auto px-10 py-24">
        <div class="grid lg:grid-cols-2 gap-32 items-center">
            <div class="space-y-12">
                <span class="inline-flex items-center gap-3 bg-accent/10 text-accent px-6 py-3 rounded-full text-xs font-black">
                    <span class="w-2 h-2 bg-accent rounded-full animate-ping"></span>
                    نظام الحلقات الذكي V5.0
                </span>
                <h2 class="text-9xl font-black text-primary dark:text-white leading-[0.9] tracking-tighter">
                    جيلٌ <br> <span class="quran-text font-normal text-accent italic">يَتْلُو</span> <br> ويَرْتَقِي
                </h2>
                <p class="text-xl font-medium max-w-xl text-text-body">
                    منصة "صرح التابعين" ليست مجرد موقع، بل هي بيئة تربوية رقمية تهدف لمتابعة حفظة كتاب الله في النصيرات بأحدث معايير الجودة العالمية.
                </p>
                <div class="flex gap-8">
                    <button onclick="nav('rings')" class="bg-primary text-white px-12 py-7 rounded-[25px] font-black text-xl hover-lift shadow-2xl">تصفح الحلقات ←</button>
                    <button onclick="nav('student')" class="bg-white text-primary border-4 border-slate-100 px-12 py-7 rounded-[25px] font-black text-xl hover-lift">دخول الطلاب</button>
                </div>
            </div>
            <div class="relative group">
                <div class="absolute -inset-4 bg-accent rounded-[80px] rotate-3 opacity-20 blur-2xl group-hover:rotate-6 transition-all"></div>
                <img src="https://images.unsplash.com/photo-1590076215667-875d45499e67?q=80&w=1000" class="relative z-10 rounded-[80px] shadow-3xl border-[20px] border-white dark:border-primary-light h-[700px] w-full object-cover">
            </div>
        </div>
    </main>

    <section id="ringsPage" class="page-node max-w-[1600px] mx-auto px-10 py-24">
        <div class="flex justify-between items-end mb-24 border-b-4 border-accent/10 pb-12">
            <div>
                <h2 class="text-7xl font-black text-primary dark:text-white mb-4">مراكزنا وحلقاتنا</h2>
                <p class="text-accent font-black tracking-[0.5em] text-sm uppercase">خارطة الانتشار القرآني</p>
            </div>
            <div class="flex gap-4">
                <button class="bg-primary text-white p-6 rounded-2xl"><i class="fas fa-filter"></i></button>
                <button class="bg-accent text-primary p-6 rounded-2xl"><i class="fas fa-search"></i></button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12" id="rings-grid">
            </div>
    </section>

    <section id="studentPage" class="page-node max-w-[1600px] mx-auto px-10 py-24">
        <div id="login-gate" class="max-w-2xl mx-auto bg-bg-card p-20 rounded-[60px] shadow-royal text-center border-t-[15px] border-accent">
            <div class="w-24 h-24 bg-primary text-accent rounded-full flex items-center justify-center mx-auto mb-10 text-4xl shadow-2xl">
                <i class="fas fa-fingerprint"></i>
            </div>
            <h3 class="text-4xl font-black text-primary dark:text-white mb-4">بوابة الطالب الذكية</h3>
            <p class="mb-12 font-bold opacity-60">أدخل رقم هويتك المعتمد لدى إدارة المركز</p>
            <input type="number" id="student-id-input" placeholder="رقم الهوية (جرب 123)" class="w-full text-center text-3xl mb-8">
            <button onclick="handleStudentLogin()" class="w-full bg-primary text-white py-6 rounded-2xl font-black text-xl hover:bg-accent hover:text-primary transition-all">تحقق ودخول</button>
        </div>

        <div id="student-dash" class="hidden space-y-12">
            <div class="royal-card flex flex-col lg:flex-row items-center gap-16">
                <div class="relative">
                    <div class="w-48 h-48 bg-slate-100 rounded-[40px] border-8 border-white dark:border-primary-light shadow-2xl overflow-hidden flex items-center justify-center">
                        <i class="fas fa-user-graduate text-7xl text-primary"></i>
                    </div>
                    <div class="absolute -bottom-4 -right-4 bg-green-500 text-white p-4 rounded-full border-4 border-white text-xl">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                <div class="flex-1 text-center lg:text-right">
                    <h3 id="dash-name" class="text-6xl font-black text-primary dark:text-white mb-4 italic">--</h3>
                    <div class="flex flex-wrap gap-4 justify-center lg:justify-start">
                        <span class="bg-accent/10 text-accent px-6 py-2 rounded-full font-black text-xs uppercase" id="dash-rank">رتبة: حافظ متميز</span>
                        <span class="bg-primary/10 text-primary dark:text-white px-6 py-2 rounded-full font-black text-xs uppercase" id="dash-mosque">مسجد التابعين</span>
                    </div>
                    <div class="mt-8 flex gap-4 justify-center lg:justify-start">
                        <button onclick="generateHonorCard()" class="bg-accent text-primary px-8 py-3 rounded-xl font-black text-xs shadow-lg hover:scale-105 transition">تحميل بطاقة التميز <i class="fas fa-award ml-2"></i></button>
                        <button class="bg-primary text-white px-8 py-3 rounded-xl font-black text-xs shadow-lg">سجل الدرجات</button>
                    </div>
                </div>
            </div>

            <div class="royal-card">
                <h4 class="text-2xl font-black mb-12 flex items-center gap-4">
                    <i class="fas fa-map-marked-alt text-accent"></i> مسار الإنجاز القرآني
                </h4>
                <div class="journey-container">
                    <div class="journey-line"></div>
                    <div class="journey-fill" id="journey-fill" style="width: 0%"></div>
                    <div id="journey-steps">
                        </div>
                </div>
            </div>
            
            <div class="grid lg:grid-cols-3 gap-12">
                <div class="lg:col-span-2 royal-card">
                    <canvas id="studentProgressChart" height="200"></canvas>
                </div>
                <div class="royal-card flex flex-col items-center justify-center text-center">
                    <p class="text-accent font-black text-xs uppercase tracking-widest mb-4">نسبة الإتقان</p>
                    <div class="text-8xl font-black text-primary dark:text-white" id="mastery-percent">0%</div>
                    <p class="mt-8 text-[10px] font-bold opacity-40 italic">بناءً على معايير إدارة إسماعيل نوفل</p>
                </div>
            </div>
        </div>
    </section>

    <section id="aiPage" class="page-node max-w-5xl mx-auto px-10 py-24">
        <div class="bg-bg-card rounded-[60px] shadow-royal overflow-hidden border-b-[20px] border-primary">
            <div class="bg-primary p-12 text-white flex flex-col md:flex-row justify-between items-center gap-10">
                <div class="flex items-center gap-8">
                    <button id="mic-btn" onclick="toggleVoiceRec()" class="w-24 h-24 bg-accent text-primary rounded-full flex items-center justify-center text-4xl shadow-2xl transition-all">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <div>
                        <h3 class="text-4xl font-black italic">المساعد الصوتي الذكي</h3>
                        <p class="text-accent text-xs font-bold tracking-widest mt-2 uppercase">تحدث الآن .. المعلم يستمع إليك</p>
                    </div>
                </div>
                <div class="text-left">
                    <span class="bg-white/10 px-6 py-2 rounded-full text-[10px] font-black tracking-tighter">AI-MODEL: TABEEN-NEURAL-V4</span>
                </div>
            </div>
            
            <div id="chat-viewport" class="chat-container p-12 bg-slate-50 dark:bg-black/20">
                <div class="chat-bubble bot-msg">مرحباً بك يا بني. أنا معلمك الرقمي المساعد. كيف أستطيع خدمتك اليوم في رحلتك مع القرآن الكريم؟</div>
            </div>

            <div class="p-10 bg-bg-card border-t-2 border-slate-100 flex gap-6">
                <input type="text" id="ai-input-text" placeholder="اكتب سؤالك هنا أو استخدم الميكروفون..." class="flex-1">
                <button onclick="handleAIQuestion()" class="w-20 h-20 bg-primary text-accent rounded-3xl shadow-xl flex items-center justify-center text-2xl hover:bg-accent hover:text-primary transition-all">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </section>

    <section id="donatePage" class="page-node max-w-6xl mx-auto px-10 py-24 text-center">
        <div class="bg-primary p-24 rounded-[80px] text-white relative overflow-hidden shadow-royal">
            <div class="relative z-10 space-y-12">
                <h2 class="text-7xl font-black quran-text">"وَمَا تُقَدِّمُوا لِأَنْفُسِكُمْ مِنْ خَيْرٍ تَجِدُوهُ عِنْدَ اللَّهِ"</h2>
                <p class="text-xl max-w-3xl mx-auto opacity-70">ساهم في كفالة حلقات الحفظ ورعاية المتميزين في صرح التابعين بالنصيرات.</p>
                
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-white/10 p-12 rounded-[40px] border border-white/20 hover:bg-accent hover:text-primary transition-all cursor-pointer group">
                        <h4 class="font-black text-xl mb-6">سهم الطالب</h4>
                        <p class="text-6xl font-black">$20</p>
                        <hr class="my-8 opacity-20">
                        <p class="text-xs font-bold opacity-60 group-hover:opacity-100">كفالة تعليمية شهرية</p>
                    </div>
                    </div>
            </div>
        </div>
    </section>

    <div id="card-capture-area">
        <h1 style="font-size: 50px; font-weight: 900; margin-bottom: 20px; color: #c5a059;">بطاقة تميز وإبداع</h1>
        <p style="font-size: 20px; letter-spacing: 5px; margin-bottom: 40px;">مركز التابعين القرآني - النصيرات</p>
        <div style="border: 2px solid rgba(197, 160, 89, 0.5); padding: 40px; margin: 40px 0;">
            <p style="font-size: 18px; margin-bottom: 10px;">نحيطكم علماً بأن الطالب المتميز</p>
            <h2 id="capture-name" style="font-size: 60px; font-weight: 900; color: #fff; margin-bottom: 10px;">--</h2>
            <p id="capture-mosque" style="font-size: 24px; color: #c5a059; font-weight: 800;">مسجد التابعين</p>
        </div>
        <p style="font-size: 16px; opacity: 0.7;">حقق المركز الأول في اختبارات التثبيت لشهر يناير 2026</p>
        <p style="margin-top: 40px; font-weight: 900; color: #c5a059;">تحت إشراف: أ. إسماعيل نوفل</p>
    </div>

    <footer class="bg-bg-card border-t pt-24 pb-20 px-10 mt-32">
        <div class="max-w-[1600px] mx-auto grid lg:grid-cols-4 gap-20">
            <div class="lg:col-span-2 space-y-8">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-accent text-primary rounded-xl flex items-center justify-center text-xl shadow-lg"><i class="fas fa-star"></i></div>
                    <h4 class="text-2xl font-black text-primary dark:text-white uppercase tracking-tighter">منظومة التابعين التعليمية</h4>
                </div>
                <p class="max-w-md text-text-body font-medium">بناء الإنسان قبل حفظ اللسان، رؤيتنا في مركز التابعين نحو جيل قرآني متكامل يجمع بين الأدب والعلم والتقنية.</p>
            </div>
            <div class="space-y-6">
                <h5 class="font-black text-xl text-primary dark:text-white border-r-4 border-accent pr-4">روابط سريعة</h5>
                <ul class="space-y-3 font-bold text-sm">
                    <li><a href="#" class="hover:text-accent">اتفاقية الاستخدام</a></li>
                    <li><a href="#" class="hover:text-accent">من نحن</a></li>
                    <li><a href="#" class="hover:text-accent">فريق العمل</a></li>
                </ul>
            </div>
            <div class="space-y-6 text-center lg:text-right">
                <h5 class="font-black text-xl text-primary dark:text-white">تواصل معنا</h5>
                <div class="flex gap-4 justify-center lg:justify-start">
                    <div class="w-12 h-12 bg-primary text-accent rounded-xl flex items-center justify-center text-xl hover:bg-accent hover:text-primary transition-all cursor-pointer"><i class="fab fa-facebook-f"></i></div>
                    <div class="w-12 h-12 bg-primary text-accent rounded-xl flex items-center justify-center text-xl hover:bg-accent hover:text-primary transition-all cursor-pointer"><i class="fab fa-whatsapp"></i></div>
                </div>
            </div>
        </div>
        <div class="text-center mt-20 border-t pt-10 text-[10px] font-black opacity-30 uppercase tracking-[0.8em]">Designed and Programmed by Ibrahim Nofal Team © 2026</div>
    </footer>

    <script>
        /* 1. قاعدة البيانات المحلية (Local Data Engine) */
        const DB = {
            rings: [
                { id: 'tabeen', name: "مسجد التابعين", desc: "المقر الرئيسي المركزي", icon: "kaaba", count: 15, status: "نشط", color: "#001a35" },
                { id: 'moaz', name: "مسجد معاذ بن جبل", desc: "بإشراف م. محمود العمصي", icon: "mosque", count: 8, status: "مكتمل", color: "#2563eb" },
                { id: 'noor', name: "مسجد ذو النورين", desc: "بإشراف أ. أحمد أبو جحجوح", icon: "star-and-crescent", count: 6, status: "متاح", color: "#059669" },
                { id: 'girls', name: "مركز الطالبات", desc: "إدارة أ. أفنان أبو الحسن", icon: "venus", count: 10, status: "نشط", color: "#db2777" }
            ],
            students: {
                "123": { name: "حمزة إبراهيم نوفل", mosque: "مسجد التابعين", progress: 18, rank: "حافظ متميز", mastery: 94, history: [10, 15, 30, 45, 60, 85, 94] },
                "456": { name: "أحمد العمصي", mosque: "مسجد معاذ بن جبل", progress: 5, rank: "مبادر", mastery: 80, history: [5, 12, 25, 40, 55, 70, 80] }
            },
            donors: ["فاعل خير - غزة", "عائلة نوفل", "محب للقرآن", "وقف التابعين", "أبو إبراهيم", "أهل الخير - النصيرات"],
            inspirations: [
                "إن هذا القرآن مأدبة الله، فتعلموا من مأدبته ما استطعتم.",
                "خيركم من تعلم القرآن وعلمه، فكن من الأخيار اليوم.",
                "صاحب القرآن يلبس والداه تاجاً يوم القيامة، فاجتهد لأجلهما.",
                "لا يزال العبد يرتفع بالقرآن حتى يبلغ منازل الأبرار."
            ]
        };

        /* 2. نظام التنقل والتحكم بالصفحات */
        function nav(id) {
            document.querySelectorAll('.page-node').forEach(p => p.classList.remove('active'));
            const target = document.getElementById(id + 'Page');
            target.classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
            gsap.from(target, {opacity: 0, y: 30, duration: 0.8});
        }

        /* 3. نظام الوضع الليلي */
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        /* 4. محرك توليد الحلقات (UI Generator) */
        function initRings() {
            const grid = document.getElementById('rings-grid');
            grid.innerHTML = DB.rings.map(ring => `
                <div class="royal-card hover-lift cursor-pointer" onclick="alert('تفاصيل ${ring.name} ستتوفر غداً مع قاعدة البيانات')">
                    <div class="w-20 h-20 rounded-3xl mb-8 flex items-center justify-center text-3xl shadow-inner" style="background: ${ring.color}20; color: ${ring.color}">
                        <i class="fas fa-${ring.icon}"></i>
                    </div>
                    <h3 class="text-3xl font-black text-primary dark:text-white mb-3">${ring.name}</h3>
                    <p class="text-sm font-bold opacity-50 mb-8 italic">${ring.desc}</p>
                    <div class="bg-slate-50 dark:bg-primary-light p-6 rounded-3xl flex justify-between items-center">
                        <span class="text-[10px] font-black uppercase tracking-widest opacity-60">${ring.count} حلقة</span>
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            <span class="text-[10px] font-black text-green-600">${ring.status}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        /* 5. بوابة الطالب والتحكم بالإحصائيات */
        let progressChart;
        function handleStudentLogin() {
            const id = document.getElementById('student-id-input').value;
            const student = DB.students[id];

            if(student) {
                gsap.to("#login-gate", { opacity: 0, scale: 0.9, duration: 0.5, onComplete: () => {
                    document.getElementById('login-gate').style.display = 'none';
                    document.getElementById('student-dash').classList.remove('hidden');
                    
                    // تحديث البيانات
                    document.getElementById('dash-name').innerText = student.name;
                    document.getElementById('capture-name').innerText = student.name;
                    document.getElementById('dash-rank').innerText = `رتبة: ${student.rank}`;
                    document.getElementById('dash-mosque').innerText = student.mosque;
                    document.getElementById('capture-mosque').innerText = student.mosque;
                    document.getElementById('mastery-percent').innerText = student.mastery + "%";

                    initStudentJourney(student.progress);
                    initStudentChart(student.history);
                }});
            } else {
                alert("رقم الهوية غير صحيح، يرجى مراجعة الإدارة.");
            }
        }

        function initStudentJourney(currentPart) {
            const stepsContainer = document.getElementById('journey-steps');
            const totalParts = 30;
            const progressFill = document.getElementById('journey-fill');
            
            stepsContainer.innerHTML = "";
            [1, 5, 10, 15, 20, 25, 30].forEach(part => {
                const status = part < currentPart ? 'completed' : (part === currentPart ? 'active' : '');
                stepsContainer.innerHTML += `
                    <div class="milestone ${status}">
                        ${part === 30 ? '<i class="fas fa-crown"></i>' : part}
                        <div class="milestone-label">جزء ${part}</div>
                    </div>
                `;
            });
            setTimeout(() => { progressFill.style.width = ((currentPart/totalParts)*100) + "%"; }, 500);
        }

        function initStudentChart(data) {
            const ctx = document.getElementById('studentProgressChart').getContext('2d');
            if(progressChart) progressChart.destroy();
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['أسبوع 1', 'أسبوع 2', 'أسبوع 3', 'أسبوع 4', 'أسبوع 5', 'أسبوع 6', 'أسبوع 7'],
                    datasets: [{
                        label: 'معدل الحفظ',
                        data: data,
                        borderColor: '#c5a059',
                        backgroundColor: 'rgba(197, 160, 89, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 4
                    }]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }

        /* 6. محرك توليد بطاقة التميز (Canvas Logic) */
        function generateHonorCard() {
            const area = document.getElementById('card-capture-area');
            html2canvas(area).then(canvas => {
                const link = document.createElement('a');
                link.download = `شهادة-تميز-التابعين.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        /* 7. المساعد الصوتي والذكاء الاصطناعي (AI Logic) */
        function toggleVoiceRec() {
            const btn = document.getElementById('mic-btn');
            btn.classList.toggle('mic-active');
            
            if(btn.classList.contains('mic-active')) {
                // محاكاة التعرف على الصوت
                setTimeout(() => {
                    const simulatedQuestions = ["متى موعد حلقة ناهض العصار؟", "كيف أراجع سورة البقرة؟", "أريد التسجيل في المسجد"];
                    const q = simulatedQuestions[Math.floor(Math.random()*simulatedQuestions.length)];
                    document.getElementById('ai-input-text').value = q;
                    handleAIQuestion();
                    btn.classList.remove('mic-active');
                }, 3000);
            }
        }

        function handleAIQuestion() {
            const input = document.getElementById('ai-input-text');
            const viewport = document.getElementById('chat-viewport');
            if(!input.value) return;

            viewport.innerHTML += `<div class="chat-bubble user-msg">${input.value}</div>`;
            
            // منطق الردود
            let reply = "سؤال رائع. نحن في مركز التابعين نحرص على تقديم أفضل إجابة. يرجى الانتظار للحظة...";
            if(input.value.includes("البقرة")) reply = "لمراجعة سورة البقرة، أنصحك بتقسيمها إلى أثمان، مراجعة ثمن كل فجر وتسميعه بعد العصر للشيخ محمد العصار.";
            if(input.value.includes("موعد")) reply = "حلقاتنا تبدأ رسمياً بعد صلاة العصر وتستمر حتى صلاة العشاء. حلقة المتميزين فجراً أيضاً.";
            if(input.value.includes("تسجيل")) reply = "التسجيل متاح عبر بوابة الموقع أو بزيارة مقرنا في مسجد التابعين بعد صلاة العصر مباشرة.";

            setTimeout(() => {
                viewport.innerHTML += `<div class="chat-bubble bot-msg">${reply}</div>`;
                viewport.scrollTop = viewport.scrollHeight;
            }, 1000);
            input.value = "";
        }

        /* 8. نظام حائط الداعمين (Wall Generator) */
        function initWall() {
            const wall = document.getElementById('wall-of-honor');
            const content = DB.donors.map(d => `<div class="donor-tag"><i class="fas fa-heart"></i> ${d}</div>`).join('');
            wall.innerHTML = content + content; // مضاعفة المحتوى لحركة مستمرة
        }

        /* 9. نظام الإلهام (Inspiration Popup) */
        function showInspiration() {
            const popup = document.getElementById('inspiration-popup');
            const content = document.getElementById('inspiration-content');
            content.innerText = DB.inspirations[Math.floor(Math.random()*DB.inspirations.length)];
            popup.style.display = 'block';
            gsap.from(popup, {x: -100, opacity: 0, duration: 1, delay: 2});
        }

        function closeInspiration() {
            document.getElementById('inspiration-popup').style.display = 'none';
        }

        /* التشغيل الرئيسي */
        window.onload = () => {
            initRings();
            initWall();
            showInspiration();
            
            // تطبيق السمة المحفوظة
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
            
            gsap.from("header", {y: -100, duration: 1.2, ease: "bounce"});
        };
    </script>
</body>
</html>
