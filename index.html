<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ† | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { --royal: #00235a; --gold: #a67c00; }
        body { font-family: 'Tajawal', sans-serif; background: #fcfcfc; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .btn-gold { background: linear-gradient(135deg, #a67c00, #d4af37); color: white; border-radius: 12px; font-weight: 800; transition: 0.3s; }
        .btn-gold:hover { transform: scale(1.02); shadow: 0 10px 15px rgba(0,0,0,0.1); }
        .input-style { background: #f3f4f6; border: 2px solid transparent; border-radius: 12px; padding: 12px; width: 100%; outline: none; }
        .input-style:focus { border-color: #a67c00; background: white; }
    </style>
</head>
<body>

    <nav class="bg-white shadow-md p-4 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="goToPage('home')">
                <div class="w-10 h-10 bg-blue-900 rounded-lg flex items-center justify-center text-white"><i class="fas fa-quran"></i></div>
                <span class="text-xl font-black text-blue-900">Ù…Ù†ØµØ© Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ†</span>
            </div>
            <div class="flex gap-4">
                <button onclick="goToPage('studentPortal')" class="text-sm font-bold text-gray-600">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
                <button onclick="goToPage('teacherLogin')" class="bg-blue-900 text-white px-4 py-2 rounded-lg text-xs font-bold">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­ÙØ¸ÙŠÙ†</button>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto p-6">
        
        <section id="home" class="page active py-20 text-center">
            <h1 class="text-5xl font-black text-blue-900 font-amiri mb-6">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø­Ù„Ù‚Ø§Øª <span class="text-gold">ØµØ±Ø­ Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ†</span></h1>
            <p class="text-gray-500 font-bold mb-10 text-lg italic">"Ù†Ø­Ùˆ Ø¬ÙŠÙ„Ù ÙŠØ­Ù…Ù„ Ø§Ù„Ù†ÙˆØ± ÙÙŠ ØµØ¯Ø±Ù‡.."</p>
            <div class="grid md:grid-cols-2 gap-6">
                <div onclick="goToPage('studentPortal')" class="p-8 bg-white border-2 border-dashed border-gray-200 rounded-3xl cursor-pointer hover:border-gold transition">
                    <i class="fas fa-user-graduate text-4xl text-blue-900 mb-4"></i>
                    <h3 class="font-black">Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                </div>
                <div onclick="goToPage('registration')" class="p-8 bg-white border-2 border-dashed border-gray-200 rounded-3xl cursor-pointer hover:border-gold transition">
                    <i class="fas fa-pen-nib text-4xl text-gold mb-4"></i>
                    <h3 class="font-black">ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
                </div>
            </div>
        </section>

        <section id="studentPortal" class="page">
            <div id="stLogin" class="max-w-md mx-auto bg-white p-8 rounded-3xl shadow-lg border">
                <h2 class="text-2xl font-black text-center mb-6">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…ÙŠ</h2>
                <input type="text" id="studentSearchID" class="input-style mb-4 text-center text-xl" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù€ ID">
                <button onclick="searchStudent()" class="w-full btn-gold py-4">ÙØªØ­ Ø§Ù„Ù…Ù„Ù</button>
            </div>
            <div id="stResult" class="hidden space-y-6">
                <div class="bg-white p-8 rounded-3xl shadow-lg border-t-8 border-blue-900">
                    <h2 id="stName" class="text-3xl font-black text-blue-900 mb-2"></h2>
                    <p id="stTeacher" class="text-gold font-bold mb-6 italic"></p>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-xl text-center">
                            <span class="block text-[10px] text-gray-400 font-bold uppercase">Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¬Ø²Ø©</span>
                            <span id="stParts" class="text-2xl font-black text-blue-900"></span>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-xl text-center">
                            <span class="block text-[10px] text-gray-400 font-bold uppercase">ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø§Ù„Ø£Ø®ÙŠØ±</span>
                            <span id="stGrade" class="text-2xl font-black text-emerald-600"></span>
                        </div>
                    </div>
                    <div class="mt-6 p-6 bg-blue-50 rounded-2xl">
                        <p class="text-xs text-blue-400 font-bold mb-2">ØªØ³Ù…ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ…:</p>
                        <p id="stToday" class="font-bold text-blue-900 italic"></p>
                    </div>
                </div>
                <button onclick="location.reload()" class="w-full text-gray-400 font-bold">Ø®Ø±ÙˆØ¬</button>
            </div>
        </section>

        <section id="teacherLogin" class="page">
             <div class="max-w-md mx-auto bg-white p-8 rounded-3xl shadow-lg border">
                <h2 class="text-2xl font-black text-center mb-6">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­ÙØ¸ÙŠÙ†</h2>
                <input type="password" id="tPass" class="input-style mb-4 text-center" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <button onclick="checkTeacherAccess()" class="w-full btn-gold py-4">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </section>

        <section id="teacherPanel" class="page">
            <div class="bg-white p-8 rounded-3xl shadow-lg border mb-6">
                <h2 class="text-2xl font-black text-blue-900 mb-6">ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù„Ù‚Ø©</h2>
                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <input type="text" id="targetID" class="input-style" placeholder="Ø±Ù‚Ù… ID Ø§Ù„Ø·Ø§Ù„Ø¨">
                    <input type="number" id="targetParts" class="input-style" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ">
                </div>
                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <select id="targetGrade" class="input-style">
                        <option>Ù…Ù…ØªØ§Ø² ğŸŒŸ</option>
                        <option>Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ ğŸ‘</option>
                        <option>ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø© âš ï¸</option>
                    </select>
                    <input type="text" id="targetToday" class="input-style" placeholder="Ù…Ø§Ø°Ø§ Ø³Ù…Ø¹ Ø§Ù„ÙŠÙˆÙ…ØŸ">
                </div>
                <textarea id="targetMsg" class="input-style h-24 mb-6" placeholder="Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø·Ø§Ù„Ø¨ ÙˆÙˆÙ„ÙŠ Ø£Ù…Ø±Ù‡..."></textarea>
                <button onclick="updateStudentScore()" id="updateBtn" class="w-full btn-gold py-4">Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©</button>
            </div>
        </section>

        <section id="registration" class="page">
            <div class="bg-white p-8 rounded-3xl shadow-lg border">
                <h2 class="text-2xl font-black text-center mb-8">Ø·Ù„Ø¨ Ø§Ù†ØªØ³Ø§Ø¨ Ù„Ù„Ù…Ø±ÙƒØ²</h2>
                <div class="space-y-4">
                    <input type="text" id="regName" class="input-style" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø±Ø¨Ø§Ø¹ÙŠ">
                    <input type="text" id="regPhone" class="input-style" placeholder="Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±">
                    <select id="regMosque" class="input-style">
                        <option>Ù…Ø³Ø¬Ø¯ Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ†</option>
                        <option>Ù…Ø³Ø¬Ø¯ Ù…Ø¹Ø§Ø° Ø¨Ù† Ø¬Ø¨Ù„</option>
                        <option>Ù…Ø³Ø¬Ø¯ Ø°Ùˆ Ø§Ù„Ù†ÙˆØ±ÙŠÙ†</option>
                    </select>
                    <input type="text" id="regTeacher" class="input-style" placeholder="Ø§Ù„Ù…Ø­ÙØ¸ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨">
                    <button onclick="registerNew()" id="regBtn" class="w-full btn-gold py-4">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </div>
        </section>

    </main>

    <div class="fixed bottom-6 left-6 z-[1000]">
        <button onclick="toggleChat()" class="w-14 h-14 bg-blue-900 text-white rounded-full shadow-2xl flex items-center justify-center text-xl"><i class="fas fa-robot"></i></button>
        <div id="chatBox" class="hidden w-80 bg-white rounded-2xl shadow-2xl border mt-4 overflow-hidden fixed bottom-24 left-6">
            <div class="bg-blue-900 p-4 text-white text-xs font-black">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ† Ø§Ù„Ø°ÙƒÙŠ</div>
            <div id="chatMessages" class="h-64 overflow-y-auto p-4 space-y-3 bg-gray-50 text-[11px] font-bold"></div>
            <div class="p-2 border-t flex gap-2">
                <input type="text" id="chatInput" class="flex-1 bg-gray-100 rounded-lg px-3 py-2 text-xs outline-none" placeholder="Ø§Ø³Ø£Ù„Ù†ÙŠ...">
                <button onclick="askAI()" class="bg-gold text-white px-3 rounded-lg"><i class="fas fa-paper-plane text-[10px]"></i></button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycby9TJ1YcsrhZm5O3TWP41B49KP2rR-2BBP2g8lzULTQvgTacOEIPk-1_GGTliBKUxNrOw/exec';

        function goToPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        // 1. Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
        async function searchStudent() {
            const id = document.getElementById('studentSearchID').value;
            if(!id) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù€ ID', 'info');
            
            try {
                const res = await fetch(`${API_URL}?action=getStudent&id=${id}`);
                const data = await res.json();
                
                if(data.found) {
                    document.getElementById('stLogin').classList.add('hidden');
                    document.getElementById('stResult').classList.remove('hidden');
                    document.getElementById('stName').innerText = data.name;
                    document.getElementById('stTeacher').innerText = `Ø§Ù„Ù…Ø­ÙØ¸: ${data.teacher}`;
                    document.getElementById('stParts').innerText = data.parts;
                    document.getElementById('stGrade').innerText = data.grade;
                    document.getElementById('stToday').innerText = data.today;
                } else {
                    Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                }
            } catch (e) { Swal.fire('Ø¹Ø°Ø±Ø§Ù‹', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error'); }
        }

        // 2. ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù„Ù„Ù…Ø¹Ù„Ù…)
        async function updateStudentScore() {
            const btn = document.getElementById('updateBtn');
            const payload = {
                action: 'updateScore',
                id: document.getElementById('targetID').value,
                parts: document.getElementById('targetParts').value,
                today: document.getElementById('targetToday').value,
                grade: document.getElementById('targetGrade').value,
                msg: document.getElementById('targetMsg').value
            };

            if(!payload.id || !payload.parts) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', 'info');

            btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                Swal.fire('Ù†Ø¬Ø§Ø­', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('targetID').value = "";
            } catch (e) { Swal.fire('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error'); }
            
            btn.disabled = false; btn.innerText = "Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©";
        }

        // 3. ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
        async function registerNew() {
            const payload = {
                name: document.getElementById('regName').value,
                phone: document.getElementById('regPhone').value,
                mosque: document.getElementById('regMosque').value,
                teacher: document.getElementById('regTeacher').value
            };

            if(!payload.name) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù…', 'info');

            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                Swal.fire('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ', 'success');
                goToPage('home');
            } catch (e) { Swal.fire('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error'); }
        }

        function checkTeacherAccess() {
            if(document.getElementById('tPass').value === "2026") goToPage('teacherPanel');
            else Swal.fire('Ø®Ø·Ø£', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
        }

        // Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø°ÙƒÙŠ (ØªØ¬Ø±ÙŠØ¨ÙŠ)
        function toggleChat() { document.getElementById('chatBox').classList.toggle('hidden'); }
        async function askAI() {
            const inp = document.getElementById('chatInput');
            const msg = inp.value; if(!msg) return;
            const box = document.getElementById('chatMessages');
            box.innerHTML += `<div class="text-blue-900 bg-blue-50 p-2 rounded-lg">Ø£Ù†Øª: ${msg}</div>`;
            inp.value = '';
            // Ù‡Ù†Ø§ ÙŠØ±Ø¨Ø· Ø¨Ù…Ø­Ø±Ùƒ Gemini Ù„Ø§Ø­Ù‚Ø§Ù‹
            setTimeout(() => {
                box.innerHTML += `<div class="text-gold bg-amber-50 p-2 rounded-lg">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯: Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ†ØŒ ÙƒÙŠÙ Ø£Ø®Ø¯Ù…ÙƒØŸ</div>`;
                box.scrollTop = box.scrollHeight;
            }, 1000);
        }
    </script>
</body>
</html>
