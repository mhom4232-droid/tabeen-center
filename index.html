<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة التابعين العالمية | الصرح الإمبراطوري 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@200;300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* =========================================
           1. نظام الألوان المتطور (Luxury Blue Palette)
           =========================================
        */
        :root {
            --p-blue: #001f3f;      /* أزرق ملكي عميق */
            --p-blue-light: #003366; 
            --p-gold: #c5a059;      /* ذهبي مطفي راقي */
            --p-gold-shine: #e6cc92;
            --p-white: #ffffff;
            --p-slate: #f1f5f9;
            --p-text: #1e293b;
            --shadow-king: 0 25px 60px -15px rgba(0, 31, 63, 0.15);
            --glass-white: rgba(255, 255, 255, 0.9);
        }

        body.dark-mode {
            --p-blue: #020617;
            --p-blue-light: #0f172a;
            --p-white: #0f172a;
            --p-slate: #020617;
            --p-text: #f1f5f9;
            --glass-white: rgba(15, 23, 42, 0.95);
        }

        /* =========================================
           2. التنسيقات العامة والخطوط
           =========================================
        */
        * { margin: 0; padding: 0; box-sizing: border-box; transition: background 0.4s, color 0.4s; }
        body { font-family: 'Tajawal', sans-serif; background: var(--p-slate); color: var(--p-text); overflow-x: hidden; }
        .quran-font { font-family: 'Amiri', serif; }

        /* =========================================
           3. شريط المتبرعين العلوي (Luxury Marquee)
           =========================================
        */
        .marquee-top {
            background: linear-gradient(90deg, var(--p-blue), var(--p-blue-light));
            border-bottom: 3px solid var(--p-gold);
            padding: 15px 0;
            overflow: hidden;
            position: relative;
            z-index: 1100;
        }
        .marquee-track {
            display: flex;
            gap: 50px;
            animation: scroll-marquee 40s linear infinite;
            width: max-content;
        }
        @keyframes scroll-marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(100%); }
        }
        .donor-item {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--p-gold);
            font-weight: 800;
            font-size: 13px;
            background: rgba(197, 160, 89, 0.1);
            padding: 8px 20px;
            border-radius: 50px;
            border: 1px solid rgba(197, 160, 89, 0.2);
            white-space: nowrap;
        }
        .donor-item span { color: white; font-weight: 400; opacity: 0.8; }

        /* =========================================
           4. نظام البوابات (Page Management)
           =========================================
        */
        .page-node { display: none; opacity: 0; transform: scale(0.98); transition: all 0.6s ease; }
        .page-node.active { display: block; opacity: 1; transform: scale(1); }

        /* =========================================
           5. بوابة التبرع "الروحانية" (Psychological Donation)
           =========================================
        */
        .donation-card {
            background: var(--p-white);
            border-radius: 50px;
            border: 1px solid rgba(197, 160, 89, 0.1);
            box-shadow: var(--shadow-king);
            padding: 60px;
            position: relative;
            overflow: hidden;
        }
        .donation-card::before {
            content: "\f683"; font-family: "Font Awesome 6 Free"; font-weight: 900;
            position: absolute; top: -50px; left: -50px; font-size: 300px;
            color: var(--p-gold); opacity: 0.03; pointer-events: none;
        }
        .amount-btn {
            padding: 25px; border: 2px solid #e2e8f0; border-radius: 25px;
            cursor: pointer; transition: all 0.3s; text-align: center;
        }
        .amount-btn:hover, .amount-btn.active {
            border-color: var(--p-gold); background: var(--p-blue); color: var(--p-gold);
            transform: translateY(-5px);
        }

        /* =========================================
           6. المساعد الذكي الصوتي (AI Interface)
           =========================================
        */
        .ai-portal {
            background: var(--p-blue); border-radius: 60px; overflow: hidden;
            box-shadow: 0 40px 100px rgba(0,0,0,0.3);
        }
        .ai-chat-screen { height: 400px; overflow-y: auto; padding: 40px; scroll-behavior: smooth; }
        .msg { max-width: 80%; padding: 20px; border-radius: 30px; margin-bottom: 20px; font-weight: 600; line-height: 1.6; }
        .bot { background: rgba(197, 160, 89, 0.15); color: var(--p-gold); border-bottom-right-radius: 5px; }
        .user { background: var(--p-gold); color: var(--p-blue); margin-right: auto; border-bottom-left-radius: 5px; }

        /* =========================================
           7. خريطة الإنجاز (Student Journey)
           =========================================
        */
        .journey-line { position: relative; height: 10px; background: #cbd5e1; border-radius: 20px; margin: 100px 0; }
        .journey-progress { position: absolute; right: 0; height: 100%; background: var(--p-gold); border-radius: 20px; transition: width 2s ease-in-out; }
        .stop {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 40px; height: 40px; background: white; border: 5px solid var(--p-gold);
            border-radius: 50%; z-index: 10;
        }
        .stop-label { position: absolute; top: 50px; left: 50%; transform: translateX(-50%); white-space: nowrap; font-size: 11px; font-weight: 900; }

    </style>
</head>
<body>

    <div class="marquee-top">
        <div class="marquee-track" id="donorTrack">
            </div>
    </div>

    <header class="sticky top-0 z-[1000] py-6 px-12 bg-white/80 dark:bg-black/80 backdrop-blur-xl border-b border-gold/10">
        <div class="max-w-[1500px] mx-auto flex justify-between items-center">
            <div class="flex items-center gap-6 cursor-pointer group" onclick="nav('home')">
                <div class="w-16 h-16 bg-[#001f3f] rounded-[22px] flex items-center justify-center text-gold shadow-2xl transition-transform group-hover:rotate-12">
                    <i class="fas fa-quran text-2xl text-[#c5a059]"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-black text-[#001f3f] dark:text-white tracking-tighter">صرح التابعين</h1>
                    <p class="text-[9px] font-black text-[#c5a059] uppercase tracking-[0.5em]">الإدارة العامة - النصيرات</p>
                </div>
            </div>

            <nav class="hidden xl:flex items-center gap-12 font-black text-[11px] uppercase tracking-widest">
                <button onclick="nav('home')" class="hover:text-gold transition">الرئيسية</button>
                <button onclick="nav('rings')" class="hover:text-gold transition">دليل الحلقات</button>
                <button onclick="nav('ai')" class="hover:text-gold transition">المعلم الذكي</button>
                <button onclick="nav('student')" class="bg-[#001f3f] text-white px-8 py-3 rounded-full hover:bg-[#c5a059] transition">بوابة الطالب</button>
                <button onclick="toggleTheme()" class="text-xl"><i class="fas fa-circle-half-stroke"></i></button>
                <button onclick="nav('donate')" class="bg-[#c5a059] text-[#001f3f] px-10 py-4 rounded-2xl shadow-xl hover:scale-105 transition-all">مساهمة وقفية</button>
            </nav>
        </div>
    </header>

    <main class="max-w-[1500px] mx-auto px-12 py-20">

        <section id="homePage" class="page-node active">
            <div class="grid lg:grid-cols-2 gap-32 items-center">
                <div class="space-y-12">
                    <span class="inline-flex items-center gap-3 bg-gold/10 text-[#c5a059] px-6 py-3 rounded-full text-xs font-black">
                        بإشراف الأستاذ: إسماعيل نوفل
                    </span>
                    <h2 class="text-9xl font-black text-[#001f3f] dark:text-white leading-[0.85] tracking-tighter">
                        اصنع <br> <span class="quran-font text-[#c5a059] font-normal italic">أثرك</span> <br> الخالد
                    </h2>
                    <p class="text-xl font-medium max-w-xl opacity-70">
                        من قلب النصيرات، نفتح آفاق التقنية لخدمة الوحيين. انضم لأكبر منظومة قرآنية متكاملة تدمج بين الأصالة والذكاء الاصطناعي.
                    </p>
                    <div class="flex gap-8">
                        <button onclick="nav('rings')" class="bg-[#001f3f] text-white px-12 py-7 rounded-[30px] font-black text-xl shadow-2xl hover:bg-[#c5a059] transition-all">تصفح الحلقات ←</button>
                        <button onclick="nav('donate')" class="bg-white border-4 border-slate-100 px-12 py-7 rounded-[30px] font-black text-xl">دعم الوقف</button>
                    </div>
                </div>
                <div class="relative">
                    <div class="absolute -inset-10 bg-[#c5a059] rounded-full blur-[120px] opacity-10"></div>
                    <img src="https://images.unsplash.com/photo-1590076215667-875d45499e67?q=80&w=1000" class="relative z-10 rounded-[80px] border-[25px] border-white dark:border-[#0f172a] shadow-3xl">
                </div>
            </div>
        </section>

        <section id="donatePage" class="page-node max-w-6xl mx-auto">
            <div class="text-center mb-20">
                <h2 class="text-6xl font-black text-[#001f3f] dark:text-white mb-6">بوابة الصدقة الجارية</h2>
                <p class="text-xl quran-font text-[#c5a059]">"وَمَا تُقَدِّمُوا لِأَنْفُسِكُمْ مِنْ خَيْرٍ تَجِدُوهُ عِنْدَ اللَّهِ"</p>
            </div>

            <div class="donation-card">
                <div class="grid lg:grid-cols-2 gap-20">
                    <div class="space-y-10">
                        <h3 class="text-4xl font-black">اختر سهمك في بناء الجيل</h3>
                        <p class="font-medium text-lg leading-relaxed opacity-60">
                            تبرعك ليس مجرد مال، بل هو ورقة في مصحف، وجلسة في حلقة، ونور في قلب طالب سيبقى أثره جارياً لك في الدنيا والآخرة. نحن في صرح التابعين نضمن لك وصول صدقتك لأهلها.
                        </p>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="amount-btn active" onclick="setAmount(50, this)">
                                <div class="text-3xl font-black">$50</div>
                                <div class="text-[10px] uppercase font-bold mt-2">كفالة حافظ</div>
                            </div>
                            <div class="amount-btn" onclick="setAmount(100, this)">
                                <div class="text-3xl font-black">$100</div>
                                <div class="text-[10px] uppercase font-bold mt-2">سهم الوقف</div>
                            </div>
                            <div class="amount-btn" onclick="setAmount(500, this)">
                                <div class="text-3xl font-black">$500</div>
                                <div class="text-[10px] uppercase font-bold mt-2">كفالة حلقة</div>
                            </div>
                            <div class="amount-btn" onclick="setAmount('custom', this)">
                                <div class="text-xl font-black">مبلغ آخر</div>
                                <div class="text-[10px] uppercase font-bold mt-2">صدقة عامة</div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-slate-50 dark:bg-black/20 p-12 rounded-[40px] space-y-8">
                        <div class="space-y-4">
                            <label class="font-black text-xs uppercase tracking-widest opacity-50">الاسم (اختياري - سيظهر في حائط الشرف)</label>
                            <input type="text" id="donorName" placeholder="فاعل خير من النصيرات" class="w-full p-6 rounded-2xl border-2 focus:border-[#c5a059] outline-none font-bold">
                        </div>
                        <div class="space-y-4">
                            <label class="font-black text-xs uppercase tracking-widest opacity-50">رسالة روحانية (تظهر للطلاب)</label>
                            <textarea id="donorMsg" placeholder="دعوة صادقة لطلابنا..." class="w-full p-6 rounded-2xl border-2 h-32 focus:border-[#c5a059] outline-none font-bold"></textarea>
                        </div>
                        <button onclick="processDonation()" class="w-full bg-[#001f3f] text-white py-8 rounded-[25px] font-black text-2xl shadow-3xl hover:bg-[#c5a059] hover:text-[#001f3f] transition-all">
                            إتمام التبرع بالسكينة <i class="fas fa-heart ml-3"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="ringsPage" class="page-node">
            <h2 class="text-6xl font-black mb-16 text-center">خارطة الصروح القرآنية</h2>
            <div class="grid md:grid-cols-3 gap-12" id="ringsContainer">
                </div>
        </section>

        <section id="studentPage" class="page-node max-w-5xl mx-auto">
            <div id="stuAuth" class="donation-card text-center">
                <div class="w-24 h-24 bg-[#001f3f] text-gold rounded-full flex items-center justify-center mx-auto mb-10 text-4xl shadow-2xl">
                    <i class="fas fa-fingerprint"></i>
                </div>
                <h3 class="text-4xl font-black mb-4">الدخول للمنظومة</h3>
                <input type="number" id="stuId" placeholder="رقم الهوية (جرب 123)" class="w-full text-center p-8 rounded-3xl border-4 text-3xl mb-10 font-black">
                <button onclick="studentLogin()" class="w-full bg-[#001f3f] text-white py-6 rounded-2xl font-black text-xl">تحقق ودخول</button>
            </div>

            <div id="stuDash" class="hidden space-y-12">
                <div class="donation-card bg-[#001f3f] text-white flex justify-between items-center">
                    <div>
                        <h3 id="userName" class="text-5xl font-black mb-4">--</h3>
                        <p class="text-[#c5a059] font-black text-lg">حافظ متميز | حلقة التابعين المركزية</p>
                        <button onclick="downloadHonorCard()" class="mt-8 bg-[#c5a059] text-[#001f3f] px-10 py-3 rounded-xl font-black shadow-xl">تحميل بطاقة التميز <i class="fas fa-award"></i></button>
                    </div>
                    <div class="text-9xl opacity-10"><i class="fas fa-crown"></i></div>
                </div>

                <div class="donation-card">
                    <h4 class="text-2xl font-black mb-20"><i class="fas fa-map-marked-alt text-[#c5a059] mr-3"></i> مسار حفظك للقرآن</h4>
                    <div class="journey-line">
                        <div class="journey-progress" id="jProgress" style="width: 0%"></div>
                        <div class="stop" style="right: 0%"><div class="stop-label">البداية</div></div>
                        <div class="stop" style="right: 25%"><div class="stop-label">الجزء 7</div></div>
                        <div class="stop" style="right: 50%"><div class="stop-label">الجزء 15</div></div>
                        <div class="stop" style="right: 75%"><div class="stop-label">الجزء 22</div></div>
                        <div class="stop" style="right: 95%"><div class="stop-label font-black text-gold">الختمة</div></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="aiPage" class="page-node max-w-4xl mx-auto">
            <div class="ai-portal">
                <div class="p-10 bg-black/20 flex justify-between items-center text-white">
                    <div class="flex items-center gap-6">
                        <button id="micBtn" onclick="toggleMic()" class="w-20 h-20 bg-[#c5a059] text-[#001f3f] rounded-full flex items-center justify-center text-3xl shadow-3xl transition-all">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <div>
                            <h3 class="text-3xl font-black italic">المعلم الرقمي الذكي</h3>
                            <p class="text-xs font-black text-[#c5a059] uppercase tracking-widest mt-1">نظام التحليل الصوتي المتقدم</p>
                        </div>
                    </div>
                </div>
                <div id="aiChat" class="ai-chat-screen bg-slate-50 dark:bg-black/10">
                    <div class="msg bot">مرحباً بك في محراب صرح التابعين. أنا معلمك المساعد، كيف أستطيع خدمتك اليوم في رحلتك مع القرآن؟</div>
                </div>
                <div class="p-8 bg-white dark:bg-black/30 flex gap-4">
                    <input type="text" id="aiInput" placeholder="اكتب سؤالك هنا أو ابدأ بالتحدث..." class="flex-1 p-6 rounded-2xl border-2 font-bold focus:border-[#c5a059] outline-none">
                    <button onclick="aiSend()" class="w-20 h-20 bg-[#001f3f] text-[#c5a059] rounded-2xl text-2xl"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </section>

    </main>

    <div id="renderCard" style="width: 800px; height: 500px; background: #001f3f; border: 20px solid #c5a059; padding: 60px; color: white; position: fixed; left: -9999px; text-align: center;">
        <h1 style="font-size: 55px; font-weight: 900; color: #c5a059; margin-bottom: 10px;">شهادة تميز وإبداع</h1>
        <p style="letter-spacing: 5px; opacity: 0.6; margin-bottom: 50px;">مركز التابعين القرآني - النصيرات</p>
        <div style="border-top: 2px solid rgba(197, 160, 89, 0.3); border-bottom: 2px solid rgba(197, 160, 89, 0.3); padding: 40px 0;">
            <p style="font-size: 20px;">نحيطكم علماً بأن الطالب المتميز</p>
            <h2 id="cardName" style="font-size: 60px; font-weight: 900; margin: 20px 0;">--</h2>
            <p style="font-size: 24px; color: #c5a059;">قد أتمَّ اختبارات التثبيت لشهر يناير 2026 بامتياز</p>
        </div>
        <p style="margin-top: 50px; font-weight: 900; font-size: 18px;">بإشراف: أ. إسماعيل نوفل</p>
    </div>

    <script>
        /* DATABASE SIMULATION 
           هنا نقوم ببناء مصفوفات بيانات ضخمة لتوليد المحتوى برمجياً
        */
        const SYSTEM_DB = {
            donors: [
                { name: "عائلة نوفل", amount: 500, msg: "لأجل جيل قرآني فريد" },
                { name: "فاعل خير من النصيرات", amount: 200, msg: "وقف لوجه الله" },
                { name: "محبو القرآن", amount: 1000, msg: "دعماً لمسيرة التابعين" },
                { name: "أبو إبراهيم", amount: 50, msg: "صدقة جارية" },
                { name: "أهل الخير من غزة", amount: 300, msg: "بالتوفيق لطلابنا" }
            ],
            rings: [
                { id: 1, name: "حلقة التابعين المركزية", leader: "أ. إسماعيل نوفل", icon: "kaaba", color: "#001f3f" },
                { id: 2, name: "حلقة المتميزين", leader: "أ. ناهض العصار", icon: "star", color: "#c5a059" },
                { id: 3, name: "حلقة صغار الحفاظ", leader: "أ. محمد العمصي", icon: "child", color: "#1e293b" },
                { id: 4, name: "مركز الطالبات", leader: "أ. أفنان أبو الحسن", icon: "venus", color: "#be185d" },
                { id: 5, name: "حلقة ذو النورين", leader: "أ. أحمد أبو جحجوح", icon: "moon", color: "#047857" },
                { id: 6, name: "حلقة الفجر", leader: "أ. إبراهيم نوفل", icon: "sun", color: "#ea580c" }
            ],
            students: {
                "123": { name: "حمزة إبراهيم نوفل", progress: 65, status: "Active" },
                "456": { name: "أحمد محمد ناصر", progress: 30, status: "Active" }
            },
            aiResponses: {
                "موعد": "حلقاتنا تبدأ بعد صلاة العصر مباشرة في كافة المساجد التابعة للمركز.",
                "تسجيل": "يمكنك التسجيل عبر زيارة مقرنا في مسجد التابعين بالنصيرات أو التواصل مع أ. إسماعيل نوفل.",
                "خطة": "أفضل خطة هي مراجعة جزأين يومياً قبل البدء في الحفظ الجديد لضمان التثبيت.",
                "بطاقة": "تظهر بطاقة التميز في صفحة الطالب عند تحقيق نسبة إتقان تتجاوز 90%."
            }
        };

        /* CORE SYSTEM FUNCTIONS 
        */

        // 1. نظام التنقل
        function nav(id) {
            document.querySelectorAll('.page-node').forEach(p => p.classList.remove('active'));
            const target = document.getElementById(id + 'Page');
            target.classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
            gsap.from(target, { opacity: 0, y: 50, duration: 0.8 });
        }

        // 2. نظام الوضع الليلي
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        // 3. بناء شريط المتبرعين (Marquee Engine)
        function initMarquee() {
            const track = document.getElementById('donorTrack');
            let content = '';
            // تكرار البيانات 5 مرات لخلق استمرارية في الشريط
            for(let i=0; i<5; i++) {
                SYSTEM_DB.donors.forEach(d => {
                    content += `
                        <div class="donor-item">
                            <i class="fas fa-heart"></i>
                            ${d.name} <span>تبرع بمبلغ</span> $${d.amount} <span>"${d.msg}"</span>
                        </div>
                    `;
                });
            }
            track.innerHTML = content;
        }

        // 4. بناء كروت الحلقات
        function initRings() {
            const container = document.getElementById('ringsContainer');
            container.innerHTML = SYSTEM_DB.rings.map(ring => `
                <div class="donation-card hover:scale-105 transition-all cursor-pointer group" onclick="alert('تفاصيل حلقة ${ring.name} ستتوفر قريباً')">
                    <div class="w-20 h-20 rounded-3xl mb-8 flex items-center justify-center text-3xl transition-transform group-hover:rotate-12" style="background: ${ring.color}20; color: ${ring.color}">
                        <i class="fas fa-${ring.icon}"></i>
                    </div>
                    <h3 class="text-3xl font-black text-[#001f3f] dark:text-white mb-3">${ring.name}</h3>
                    <p class="font-bold opacity-50 mb-8 italic">بإشراف: ${ring.leader}</p>
                    <div class="bg-slate-50 dark:bg-black/20 p-6 rounded-2xl flex justify-between items-center">
                        <span class="text-[10px] font-black uppercase text-gold">مركز فعال</span>
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            <span class="text-[10px] font-black text-green-600 uppercase tracking-tighter">نشط الآن</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 5. نظام التبرع المطور
        let currentAmount = 50;
        function setAmount(val, btn) {
            currentAmount = val;
            document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(val === 'custom') {
                const custom = prompt("أدخل المبلغ الذي تجود به نفسك:");
                if(custom) btn.querySelector('.text-xl').innerText = "$" + custom;
            }
        }

        function processDonation() {
            const name = document.getElementById('donorName').value || "فاعل خير";
            const msg = document.getElementById('donorMsg').value || "تقبل الله منا ومنكم";
            
            // محاكاة عملية الدفع بالسكينة
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> جاري ربط نيتك بالقبول...`;
            
            setTimeout(() => {
                alert(`بارك الله فيك يا ${name}. تم استلام تبرعك بقيمة $${currentAmount}. سيصلك تقرير بأثر تبرعك قريباً.`);
                btn.innerHTML = originalText;
                // إضافة المتبرع الجديد للقائمة برمجياً
                SYSTEM_DB.donors.unshift({ name, amount: currentAmount, msg });
                initMarquee();
                nav('home');
            }, 3000);
        }

        // 6. بوابة الطالب والتحقق
        function studentLogin() {
            const id = document.getElementById('stuId').value;
            const stu = SYSTEM_DB.students[id];
            if(stu) {
                gsap.to("#stuAuth", { opacity: 0, scale: 0.9, duration: 0.5, onComplete: () => {
                    document.getElementById('stuAuth').classList.add('hidden');
                    document.getElementById('stuDash').classList.remove('hidden');
                    document.getElementById('userName').innerText = stu.name;
                    document.getElementById('cardName').innerText = stu.name;
                    setTimeout(() => {
                        document.getElementById('jProgress').style.width = stu.progress + "%";
                    }, 500);
                }});
            } else {
                alert("عذراً، هذا الرقم غير مسجل في سجلاتنا.");
            }
        }

        // 7. تحميل بطاقة التميز
        function downloadHonorCard() {
            const area = document.getElementById('renderCard');
            html2canvas(area).then(canvas => {
                const link = document.createElement('a');
                link.download = `شهادة_تميز_${Date.now()}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // 8. محرك المعلم الذكي الصوتي
        function toggleMic() {
            const btn = document.getElementById('micBtn');
            btn.classList.toggle('bg-red-500');
            btn.classList.toggle('animate-pulse');
            
            if(btn.classList.contains('bg-red-500')) {
                // محاكاة استماع صوتي
                setTimeout(() => {
                    const simulatedQs = ["متى موعد الحلقة؟", "كيف أسجل؟", "أريد خطة مراجعة"];
                    const q = simulatedQs[Math.floor(Math.random()*simulatedQs.length)];
                    document.getElementById('aiInput').value = q;
                    aiSend();
                    btn.classList.remove('bg-red-500', 'animate-pulse');
                }, 3000);
            }
        }

        function aiSend() {
            const input = document.getElementById('aiInput');
            const chat = document.getElementById('aiChat');
            if(!input.value) return;

            chat.innerHTML += `<div class="msg user">${input.value}</div>`;
            
            let response = "سؤال قيم جداً. نحن في صرح التابعين نعتز باهتمامك. يرجى مراجعة الإدارة لمزيد من التفاصيل الدقيقة.";
            
            Object.keys(SYSTEM_DB.aiResponses).forEach(key => {
                if(input.value.includes(key)) response = SYSTEM_DB.aiResponses[key];
            });

            setTimeout(() => {
                chat.innerHTML += `<div class="msg bot">${response}</div>`;
                chat.scrollTop = chat.scrollHeight;
            }, 1000);
            input.value = "";
        }

        /* INITIALIZATION */
        window.onload = () => {
            initMarquee();
            initRings();
            console.log("Tabeen System V6.0 Fully Loaded.");
        };
    </script>
</body>
</html>
